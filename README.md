# vNext (Go)

**vNext** is a high-performance, concurrent workflow engine written in Go designed for building LLM-based applications and AI agents.

## ğŸš€ Key Features

*   **Native Concurrency**: Built on Go's Goroutines and Channels. Supports massive parallelism (e.g., thousands of concurrent loop iterations) with minimal overhead.
*   **Hierarchical Memory System**: Implements a tree-based scoping mechanism. Each loop iteration or parallel branch gets its own isolated memory scope, preventing variable pollution and ensuring thread safety.
*   **State Checkpointing**: Inspired by LangGraph, the engine supports a `Checkpointer` interface. State is saved as immutable snapshots after every node execution, enabling future features like "Time Travel" and reliable retries.
*   **Type-Safe & Compiled**: Static typing catches errors at build time. Deploys as a single, lightweight binary.

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          vNEXT ENGINE                                â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    WORKFLOW DEFINITION                          â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚    â”‚
â”‚  â”‚   â”‚  YAML File   â”‚â”€parseâ”€â”€â–º â”‚   DSL Parser            â”‚        â”‚    â”‚
â”‚  â”‚   â”‚              â”‚          â”‚   (WorkflowDefinition)  â”‚        â”‚    â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                             â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                   CORE RUNTIME ENGINE                           â”‚    â”‚
â”‚  â”‚                                                                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚  â”‚  â”‚  Engine                                            â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  - Goroutine-based execution                       â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  - DAG dependency resolution                       â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  - Concurrent node execution                       â”‚         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â”‚         â”‚                 â”‚                   â”‚                 â”‚    â”‚
â”‚  â”‚         â–¼                 â–¼                   â–¼                 â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”‚
â”‚  â”‚  â”‚HIERARCHICAL  â”‚  â”‚CHECKPOINTER  â”‚  â”‚  NODE REGISTRY   â”‚     â”‚    â”‚
â”‚  â”‚  â”‚   MEMORY     â”‚  â”‚  INTERFACE   â”‚  â”‚                  â”‚     â”‚    â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  - StartNode     â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  - LLMNode       â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â”‚Root     â”‚  â”‚  â”‚ â”‚InMemory  â”‚ â”‚  â”‚  - CodeNode      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â”‚Scope    â”‚  â”‚  â”‚ â”‚CP        â”‚ â”‚  â”‚  - LoopNode      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  - IfElseNode    â”‚     â”‚    â”‚
â”‚  â”‚  â”‚      â”‚       â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  - ToolNode      â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”  â”‚  â”‚ â”‚Redis/PG  â”‚ â”‚  â”‚  - AnswerNode    â”‚     â”‚    â”‚
â”‚  â”‚  â”‚ â”‚Child    â”‚  â”‚  â”‚ â”‚CP        â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â”‚
â”‚  â”‚  â”‚ â”‚Scope 1  â”‚  â”‚  â”‚ â”‚(Future)  â”‚ â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚              â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚Child    â”‚  â”‚  â”‚ Snapshots:   â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ â”‚Scope 2  â”‚  â”‚  â”‚ thread_id -> â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚ state_map    â”‚                           â”‚    â”‚
â”‚  â”‚  â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚    â”‚
â”‚  â”‚  â”‚ Variables:   â”‚                                             â”‚    â”‚
â”‚  â”‚  â”‚ - Bubble-up  â”‚                                             â”‚    â”‚
â”‚  â”‚  â”‚ - Isolated   â”‚                                             â”‚    â”‚
â”‚  â”‚  â”‚ - Thread-safeâ”‚                                             â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                   EXECUTION FLOW                            â”‚     â”‚
â”‚  â”‚                                                              â”‚     â”‚
â”‚  â”‚  Step 1       Step 2        Step 3        Step N            â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”            â”‚     â”‚
â”‚  â”‚  â”‚Startâ”‚â”€â”€â”€â”€â–ºâ”‚Node â”‚â”€â”€â”€â”€â”€â–ºâ”‚Node â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ End â”‚            â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜     â”‚  A  â”‚      â”‚  B  â”‚       â””â”€â”€â”€â”€â”€â”˜            â”‚     â”‚
â”‚  â”‚              â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜                           â”‚     â”‚
â”‚  â”‚                 â”‚             â”‚                              â”‚     â”‚
â”‚  â”‚                 â–¼             â–¼                              â”‚     â”‚
â”‚  â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚     â”‚
â”‚  â”‚           â”‚Checkpoint â”‚Checkpoint â”‚                         â”‚     â”‚
â”‚  â”‚           â”‚(State 1)  â”‚(State 2)  â”‚                         â”‚     â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Design Principles

- **Goroutine-Native**: Each node can spawn thousands of lightweight concurrent tasks
- **Scoped Memory**: Child scopes inherit from parent, preventing variable pollution
- **Snapshot State**: Every node execution triggers a state checkpoint
- **DAG Execution**: Topological sort with concurrent branch execution

### Concurrency Model

vNext leverages Go's native concurrency primitives to achieve high-performance parallel execution:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   CONCURRENT EXECUTION MODEL                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Scenario 1: DAG Parallel Execution                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚                                                                  â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚
â”‚            â”‚  Start   â”‚                                          â”‚
â”‚            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚                 â”‚                                                â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚       â”‚         â”‚         â”‚                                     â”‚
â”‚       â–¼         â–¼         â–¼                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚Goroutineâ”‚â”‚Goroutineâ”‚â”‚Goroutineâ”‚                             â”‚
â”‚  â”‚    1    â”‚â”‚    2    â”‚â”‚    3    â”‚                             â”‚
â”‚  â”‚         â”‚â”‚         â”‚â”‚         â”‚                             â”‚
â”‚  â”‚LLM Node â”‚â”‚  Code   â”‚â”‚LLM Node â”‚                             â”‚
â”‚  â”‚    A    â”‚â”‚  Node   â”‚â”‚    B    â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                             â”‚
â”‚       â”‚          â”‚          â”‚                                   â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                  â–¼                                               â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                       â”‚
â”‚          â”‚ Aggregation  â”‚                                       â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Scenario 2: Loop Concurrent Iteration                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚                                                                  â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚         â”‚LoopNode  â”‚  Items: [A, B, C, D, E]                   â”‚
â”‚         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚              â”‚                                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚    â”‚         â”‚         â”‚         â”‚         â”‚                   â”‚
â”‚    â–¼         â–¼         â–¼         â–¼         â–¼                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚ â”‚ Go 1 â”‚ â”‚ Go 2 â”‚ â”‚ Go 3 â”‚ â”‚ Go 4 â”‚ â”‚ Go 5 â”‚                  â”‚
â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚                  â”‚
â”‚ â”‚Item:Aâ”‚ â”‚Item:Bâ”‚ â”‚Item:Câ”‚ â”‚Item:Dâ”‚ â”‚Item:Eâ”‚                  â”‚
â”‚ â”‚Scope1â”‚ â”‚Scope2â”‚ â”‚Scope3â”‚ â”‚Scope4â”‚ â”‚Scope5â”‚                  â”‚
â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚ â”‚      â”‚                  â”‚
â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚ â”‚â”Œâ”€â”€â”€â”€â”â”‚                  â”‚
â”‚ â”‚â”‚LLM â”‚â”‚ â”‚â”‚LLM â”‚â”‚ â”‚â”‚LLM â”‚â”‚ â”‚â”‚LLM â”‚â”‚ â”‚â”‚LLM â”‚â”‚                  â”‚
â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚ â”‚â””â”€â”€â”€â”€â”˜â”‚                  â”‚
â”‚ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”˜                  â”‚
â”‚    â”‚        â”‚        â”‚        â”‚        â”‚                      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                      â”‚                                         â”‚
â”‚                      â–¼                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚              â”‚ Results: []  â”‚                                  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Key Characteristics:                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                  â”‚
â”‚  â€¢ Lightweight: Each goroutine uses ~2KB stack (vs ~1MB thread) â”‚
â”‚  â€¢ Non-blocking: Channel-based coordination                     â”‚
â”‚  â€¢ Scalable: Can spawn 10,000+ concurrent tasks                 â”‚
â”‚  â€¢ Isolated: Each iteration has independent memory scope        â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```



## ğŸ“‚ Project Structure

```
dify-vnext-go/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go           # Application entry point
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ dsl/              # Workflow DSL definitions and YAML parser
â”‚   â”œâ”€â”€ engine/           # Core runtime (Engine, Memory, State/Checkpointer)
â”‚   â””â”€â”€ nodes/            # Node implementations (Start, LLM, Code, Loop, etc.)
â”œâ”€â”€ examples/             # Example workflow YAML files
â””â”€â”€ go.mod                # Go module definition
```

## ğŸ› ï¸ Getting Started

### Prerequisites

*   **Go 1.21+** installed.
*   **OpenAI API Key** (Optional, for LLM nodes).
    ```bash
    export OPENAI_API_KEY="sk-..."
    ```
    *If not provided, LLM nodes will return mock responses.*

### Running Examples

The project comes with several example workflows to demonstrate its capabilities.

1.  **Simple Workflow** (Linear execution):
    ```bash
    go run cmd/main.go -f examples/simple.yaml
    ```

2.  **Complex Workflow** (Branching & Tools):
    ```bash
    go run cmd/main.go -f examples/complex.yaml
    ```

3.  **Customer Support Triage** (Conditional Routing):
    ```bash
    go run cmd/main.go -f examples/support_triage.yaml
    ```

4.  **Automated Code Review** (Parallel Execution):
    ```bash
    go run cmd/main.go -f examples/code_review.yaml
    ```

5.  **Multi-language Translation** (Loops):
    ```bash
    go run cmd/main.go -f examples/translation.yaml
    ```

## ğŸ§  Architecture Highlights

### Memory Management
vNext implements a **Hierarchical Scoping** system for memory management.
- **Global Scope**: Inputs to the `Start` node.
- **Child Scope**: Created for each `Loop` iteration.
- **Bubble-Up Lookup**: Variables are looked up in the current scope, then the parent, up to the root.
- **Isolation**: Ensures parallel branches and iterations don't interfere with each other.

### Checkpointing
The engine integrates a `Checkpointer` that saves the state of the entire memory tree after each node execution.
- **Current Implementation**: `InMemoryCheckpointer` (for MVP/Testing).
- **Future**: Redis/Postgres implementations for persistent state and time-travel debugging.

## ğŸ¤ Contributing
Contributions are welcome! Please check the `pkg/nodes` directory to see how to implement new node types.
